<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>QuickHAC</title>
		<link rel="stylesheet" type="text/css" href="css/main.css">
	</head>
	<body>
		<div class="main-view">
			<div class="login">
				<div class="logo">
					<i class="fa fa-rocket"></i>
					<span class="message-welcome">
						Welcome to
						<span class="app-name">Quick<span>HAC</span></span>
					</span>
				</div>
				<form class="login-panel" name="login">
					<div class="split-button-group">
						<label><input type="radio" name="district" value="RRISD" checked tabindex="1" /> <span>RRISD</span></label>
						<label><input type="radio" name="district" value="AISD" tabindex="2" /> <span>AISD</span></label>
					</div>
					<button class="button-login" type="submit" tabindex="6" disabled><span class="available">Login <i class="fa fa-sign-in"></i></span><span class="busy">Logging in&hellip;</span></button>
					<div class="input-group">
						<label class="text-input input-username"><input type="text" name="username" placeholder="HAC Username" tabindex="3" autocomplete="off" required autofocus /><i class="fa fa-user fw"></i></label>
						<label class="text-input input-password"><input type="password" name="password" placeholder="HAC Password" tabindex="4" autocomplete="off" required /><i class="fa fa-key fw"></i></label>
						<label class="text-input input-id"><input type="text" name="id" placeholder="Student ID" tabindex="5" autocomplete="off" required pattern="\d+" /><i class="fa fa-credit-card fw"></i></label>
					</div>
					<a href="#">Lost your password?</a>
				</form>
			</div>
		</div>
		<script type="text/javascript">
		// To allow forEach on NodeList
		function forEach() {
			var args = [].slice.call(arguments, 0);
			var ctx = args.shift();
			return [].forEach.apply(ctx, args);
		}

		var form = document.forms["login"];
		form["username"].addEventListener("keyup", validate, false);
		form["password"].addEventListener("keyup", validate, false);
		form["id"].addEventListener("keyup", validate, false);
		var button = form.querySelector("button");

		forEach(document.querySelectorAll(".split-button-group input"), function (el) {
			el.addEventListener("change", function (e) {
				var username = form["username"].value;
				var password = form["password"].value;
				var id = form["id"].value;

				if (username === "") {
					form["username"].focus();
				} else if (password === "") {
					form["password"].focus();
				} else if (id === "") {
					form["id"].focus();
				} else {
					button.focus();
				}
			}, false);
		});

		function disableForm() {
			form.classList.add("busy");
			forEach(form.querySelectorAll(".split-button-group input"), function (el) {
				el.disabled = true;
			});
			form["username"].disabled = true;
			form["password"].disabled = true;
			form["id"].disabled = true;
			button.disabled = true;
		}
		function enableForm() {
			form.classList.remove("busy");
			forEach(form.querySelectorAll(".split-button-group input"), function (el) {
				el.disabled = false;
			});
			form["username"].disabled = false;
			form["password"].disabled = false;
			form["id"].disabled = false;
			button.disabled = false;
		}

		function responseHandler(error) {
			if (error) {
				// Error while logging in
				// Allow input
				enableForm();
				form.classList.add("error");
				setTimeout(function () {
					form.classList.remove("error");
				}, 3000);
				console.error("Unable to log in.");
				return;
			}
			// Login succeeded
			// Placeholder navigation
			location.href = location.href.replace("login.html", "dashboard.html");
		}

		form.addEventListener("submit", function (e) {
			console.log("logging in...");
			// Prevent form from changing page
			e.preventDefault();
			// Disallow further input
			disableForm();

			// Placeholder server success
			var success = form["username"].value === "admin" && form["password"].value === "abc" && form["id"].value === "123456";

			// Placeholder server response
			setTimeout(responseHandler.bind(null, !success), success ? 1000 : 3000);
		}, false);

		function validate() {
			var ID_isNumeric = !form["id"].validity.patternMismatch;
			var ID_isLongEnough = form["id"].value.length >= 6;
			var ID_isValid;

			// If ID entered is numeric
			if (ID_isNumeric) {
				// Do not display it as invalid
				form["id"].classList.remove("invalid");
				// Validate only if ID is long enough
				ID_isValid = ID_isLongEnough;
			} else {
				// ID is not numeric
				// Display ID as invalid
				form["id"].classList.add("invalid");
				// Do not validate
				ID_isValid = false;
			}

			if (form["username"].checkValidity() && form["password"].checkValidity() && ID_isValid) {
				// Display submit button
				button.disabled = false;
			} else {
				// Hide submit button
				button.disabled = true;
			}
		}
		</script>
	</body>
</html>
